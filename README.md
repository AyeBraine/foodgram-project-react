# Дипломный проект Яндекс.Практикум: Python Backend

# Продуктовый помощник Foodgram: сайт с рецептами

![YaMDB CI/CD workflow](https://github.com/AyeBraine/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg)

[Ссылка на развёрнутый проект на сервере Yandex.Cloud](http://51.250.94.185/api/recipes/)

[Ссылка на этот репозиторий](https://github.com/AyeBraine/foodgram-project-react)

## Описание проекта

**Foodgram** — это простой сайт для создания и чтения рецептов блюд, с возможностью создать свой профиль пользователя, подписываться на других авторов, добавлять рецепты в избранное и в корзину (корзина используется для формирования списка покупок).

*Данная версия Foodgram собрана в виде комплекса контейнеров Docker для развёртывания локально и в вебе. Ниже приведены инструкции по развёртыванию сервиса на удалённом сервере.*

**Поддерживаемые функции**

* автоматизированное развёртывание по принципу Continuous Integration/Deployment (CI/CD) и утилита для заполнения базы данных ингредиентами
* создание и редактирование пользователями рецептов
* подписки на пользователей и чтение ленты подписок
* добавление рецептов в Избранное и Список покупок
* формирование PDF-файла для распечатки со списком продуктов для рецептов из Списка покупок
* создание профиля пользователя и смена пароля, аутентификация по Token Authorization и разные права для администраторов, авторизованных и анонимных пользователей.
* управление любым контентом для администраторов, функциональная панель администрирования CMS 

В проекте использованы фреймворки Django и Django REST, аутентикация пользователей с помощью Djoser, фильтрующие бэкенды django-filters, система вывода в PDF ReportLab.

**Сервер создан на базе Gunicorn, PostgreSQL и nginx и контейнеризован с помощью Docker. CI/CD реализованы на базе Github Actions.**

## Установка и развертывание

Чтобы развернуть этот проект на удалённом сервере, следует:

1. Подготовить инструменты: 

* клонировать из профиля AyeBraine на GitHub репозиторий *foogram-project-react* в свой профиль GitHub
* создать собственный профиль на сервисе Docker Hub
* установить на удалённом сервере Docker (Ubuntu: sudo apt install docker.io)

2. Далее следует внести в репозиторий изменения: добавить правильный IP-адрес вашего сервера в файлы backend/backend/settings.py и infra/nginx.conf.

3. В вашем профиле на GitHub следует создать ряд секретов (Secrets) — переменных среды для Github Actions. В разделе Settings репозитория выберите Secrets/Actions и добавьте следующие переменные (каждая — это отдельный секрет):
```
CLOUD_CODE: пароль для терминала к вашему серверу при наличии
CLOUD_IP: публичный IP-адрес вашего сервера
CLOUD_USERNAME: имя пользователя для SSH-логина на сервер
DB_ENGINE: django.db.backends.postgresql
DB_NAME: postgres
POSTGRES_USER: postgres
POSTGRES_PASSWORD: postgres
DB_HOST: db
DB_PORT: 5432
DOCKER_USERNAME: ваше имя пользователя на Docker Hub
DOCKER_PASSWORD: пароль к аккаунту на Docker Hub
SSH_KEY: ключ SSH на вашем компьютере (bash: cat ~/.ssh/id_rsa)

А также опционально:
TELEGRAM_TO: ваш ID пользователя Telegram (получить у @userinfobot)
TELEGRAM_TOKEN: токен безопасности для бота (получить у @BotFather)
```

4. Cоздайте новый коммит в репозитории и выполните git push. При этом на GitHub запустится workflow Github Actions, включённый в репозиторий. За его выполнением можно следить во вкладке Actions.

**Теперь вы можете протестировать проект!**

## Админка и аутентификация

Чтобы увидеть все страницы проекта, придётся сначала создать суперпользователя. Для этого

Для этого подключитесь к контейнеру с бэкендом проекта через терминал на вашем сервере:
```
docker exec -it infra-web-1 bash
```
В нём выполните команду:
```
python manage.py createsuperuser
```
...выбрав собственные username, email и пароль.

> Учтите, что логин на самом сайте Foodgram осуществляется по email!

С этой парой username зайдите в **панель администрирования Django**. Она доступна по этому адресу:
```
<IP-адрес вашего сервера>/admin/
```
Также с помощью manage.py вы можете изменить пароль для существующих пользователей:
```
python manage.py changepassword <username>
```
Для тестирования API с помощью отправки запросов (например, через Postman), вам нужно будет создать токен авторизации. Для этого с помощью CURL или Postman отправьте в теле JSON запроса POST на эндпойнт /auth/token/login/ с почтой и паролем пользователя:
```
{
    "password": "<пароль>",
    "email": "<адрес почты>"
}
```
Токен следует добавить в Header всех запросов в виде API Key. Формат пары ключ-значение:
```
Key: Authorization
Token: Token <полученный вами токен>
```

## Примеры запросов к API

Подробная документация API в формате ReDoc доступна прямо в развёрнутом сайте, по адресу:
```
<ваш_сервер>/api/docs/
```
Там вы можете увидеть точный формат запросов и варианты тегов в адресной строке. Если вкратце — доступны следующие эндпойнты API:

> Все пути в формате <ваш_сервер>/api/<эндпойнт>

* /recipes/ или /recipes/<id>/ (GET, POST, PATCH)
* /recipes?<фильтр=id>&<другой_фильтр=id>
* /recipes/favorite/ (POST, DELETE)
* /recipes/shopping_cart/ (POST, DELETE)
* /recipes/download_shopping_cart/ (GET)
* /users/ или /users/<id>/ (GET, POST)
* /users/me/ (GET)
* /users/subscriptions/ (GET)
* /users/subscribe/ (POST, DELETE)
* /auth/token/login/ (POST)
* /auth/token/logout/ (POST)
* /tags/ или /tags/<id>/ (GET)
* /ingredients/ или /ingredients/<id>/ (GET)

_Конец документа_